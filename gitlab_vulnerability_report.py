import requests
import urllib3

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

# Replace these values with your GitLab details
GITLAB_URL = ""  # Your GitLab instance URL
PERSONAL_ACCESS_TOKEN = ""
PROJECT_ID = ""  # Replace with your project ID

# API Endpoint for vulnerabilities
API_URL = f"{GITLAB_URL}/api/v4/projects/{PROJECT_ID}/vulnerabilities"

# Function to get the vulnerability report
def get_vulnerability_report():
    headers = {
        "Private-Token": PERSONAL_ACCESS_TOKEN
    }
    params = {
        "page": 1,
        "per_page": 100  # Adjust as needed
    }

    try:
        response = requests.get(API_URL, headers=headers, params=params)
        response.raise_for_status()  # Raise an error for HTTP codes >= 400
        vulnerabilities = response.json()
        return vulnerabilities
    except requests.exceptions.RequestException as e:
        print(f"Error fetching vulnerability report: {e}")
        return None

# Fetch the report and print it
vulnerabilities = get_vulnerability_report()
if vulnerabilities:
    for vuln in vulnerabilities:
        print(vuln)
        print(f"ID: {vuln['id']}, Title: {vuln['title']}, Severity: {vuln['severity']}")
